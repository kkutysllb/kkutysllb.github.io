<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="fdisk：磁盘分区工具fdisk是Linux下常用的磁盘分区工具。受mbr分区表的限制，fdisk工具只能给小于2TB的磁盘划分分区。如果使用fdisk对大于2TB的磁盘进行分区，虽然可以分区，但其仅识别2TB的空间，所以磁盘容量若超过2TB，就要使用parted分区工具（后面会讲）进行分区。">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》">
<meta property="og:url" content="https://kkutysllb.cn/2019/05/02/2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》/index.html">
<meta property="og:site_name" content="一花一菩提，一云一世界">
<meta property="og:description" content="fdisk：磁盘分区工具fdisk是Linux下常用的磁盘分区工具。受mbr分区表的限制，fdisk工具只能给小于2TB的磁盘划分分区。如果使用fdisk对大于2TB的磁盘进行分区，虽然可以分区，但其仅识别2TB的空间，所以磁盘容量若超过2TB，就要使用parted分区工具（后面会讲）进行分区。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae26095c66.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae29766516.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae336aa7df.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae373158e0.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae3c2d6d94.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae3fee7aba.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae42a1b479.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae4502e412.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae470c6349.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae4da09a97.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae4f632933.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae591533e9.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae5a7e7b0e.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae65d205b3.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae6c094551.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/02/5ccae8ce512d2.jpg">
<meta property="og:updated_time" content="2019-05-02T12:56:05.995Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》">
<meta name="twitter:description" content="fdisk：磁盘分区工具fdisk是Linux下常用的磁盘分区工具。受mbr分区表的限制，fdisk工具只能给小于2TB的磁盘划分分区。如果使用fdisk对大于2TB的磁盘进行分区，虽然可以分区，但其仅识别2TB的空间，所以磁盘容量若超过2TB，就要使用parted分区工具（后面会讲）进行分区。">
<meta name="twitter:image" content="https://i.loli.net/2019/05/02/5ccae26095c66.jpg">



  <link rel="alternate" href="/atom.xml" title="一花一菩提，一云一世界" type="application/atom+xml">




  <link rel="canonical" href="https://kkutysllb.cn/2019/05/02/2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》 | 一花一菩提，一云一世界</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?45d7282259ecad100b2fe7e379853e80";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">一花一菩提，一云一世界</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">佛系ICT人士技术博客</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kkutysllb.cn/2019/05/02/2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kkutysllb">
      <meta itemprop="description" content="容易走的路是下坡路<br>总是不经意间装个X得罪一票人">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一花一菩提，一云一世界">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-02 20:27:07 / 修改时间：20:56:05" itemprop="dateCreated datePublished" datetime="2019-05-02T20:27:07+08:00">2019-05-02</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux核心命令/" itemprop="url" rel="index"><span itemprop="name">Linux核心命令</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">31k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">28 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="fdisk：磁盘分区工具"><a href="#fdisk：磁盘分区工具" class="headerlink" title="fdisk：磁盘分区工具"></a>fdisk：磁盘分区工具</h2><p>fdisk是Linux下常用的磁盘分区工具。受mbr分区表的限制，fdisk工具只能给小于2TB的磁盘划分分区。如果使用fdisk对大于2TB的磁盘进行分区，虽然可以分区，但其仅识别2TB的空间，所以磁盘容量若超过2TB，就要使用parted分区工具（后面会讲）进行分区。<a id="more"></a></p>
<p><strong>语法格式：fdisk [option] [device]</strong></p>
<p><strong>重要参数选项</strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae26095c66.jpg"></p>
<p><strong>【使用示例】</strong></p>
<p><strong>1）显示系统磁盘分区列表</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@C7-Server01 ~]<span class="comment"># fdisk -l</span></span><br><span class="line">Disk /dev/sda: 53.7 GB, 53687091200 bytes, 104857600 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x000d2190</span><br><span class="line">Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048      821247      409600   83  Linux</span><br><span class="line">/dev/sda2          821248    17598463     8388608   82  Linux swap / Solaris</span><br><span class="line">/dev/sda3        17598464   104857599    43629568   83  Linux</span><br></pre></td></tr></table></figure>
<p>上述信息每列功能说明具体如下：</p>
<ul>
<li>Device：分区，这里有三个分区；</li>
<li>Boot：启动分区，用*表示的是启动分区；</li>
<li>Start：表示开始的柱面；</li>
<li>End：表示结束的柱面；</li>
<li>Blocks：block块数量；</li>
<li>Id：分区类型Id；</li>
<li>System：分区类型</li>
</ul>
<p><strong>2）模拟添加第二块磁盘</strong></p>
<p>#给C7 Server01再挂载一块20G的磁盘</p>
<p><img src="https://i.loli.net/2019/05/02/5ccae29766516.jpg"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启系统检查磁盘分区状态</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># fdisk -l</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新添加的磁盘为/devsdb，表示sata接口的第二块磁盘</span></span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 53.7 GB, 53687091200 bytes, 104857600 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x000d2190</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048      821247      409600   83  Linux</span><br><span class="line">/dev/sda2          821248    17598463     8388608   82  Linux swap / Solaris</span><br><span class="line">/dev/sda3        17598464   104857599    43629568   83  Linux</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不想显示其他分区，还可以指定分区查看</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># fdisk -l /dev/sdb</span></span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br></pre></td></tr></table></figure>
<p><strong>3）交互式分区实战</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前系统的分区设备信息</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># ls -l /dev/sd*</span></span><br><span class="line">brw-rw---- 1 root disk 8,  0 May  2 09:41 /dev/sda</span><br><span class="line">brw-rw---- 1 root disk 8,  1 May  2 09:41 /dev/sda1</span><br><span class="line">brw-rw---- 1 root disk 8,  2 May  2 09:41 /dev/sda2</span><br><span class="line">brw-rw---- 1 root disk 8,  3 May  2 09:41 /dev/sda3</span><br><span class="line">brw-rw---- 1 root disk 8, 16 May  2 09:41 /dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对/dev/sdb进行交互式分区</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># fdisk /dev/sdb</span></span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">Building a new DOS disklabel with disk identifier 0xc0a89c6e.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): m     <span class="comment"># 输入m，打印帮助信息</span></span><br><span class="line">Command action</span><br><span class="line">   a   toggle a bootable flag    <span class="comment"># 设置引导扇区</span></span><br><span class="line">   b   edit bsd disklabel     <span class="comment"># 编辑bsd卷标</span></span><br><span class="line">   c   toggle the dos compatibility flag   <span class="comment"># 设置dos兼容分区</span></span><br><span class="line">   d   delete a partition    <span class="comment"># 删除一个分区</span></span><br><span class="line">   g   create a new empty GPT partition table    <span class="comment"># 创建一个新的且为空的GPT分区表</span></span><br><span class="line">   G   create an IRIX (SGI) partition table   <span class="comment"># 创建一些IRIX分区表</span></span><br><span class="line">   l   list known partition types    <span class="comment"># 查看分区类型对应的编号列表</span></span><br><span class="line">   m   <span class="built_in">print</span> this menu   <span class="comment"># 打印帮助菜单</span></span><br><span class="line">   n   add a new partition   <span class="comment"># 新建一个分区</span></span><br><span class="line">   o   create a new empty DOS partition table    <span class="comment"># 创建一个新的空的DOS分区表</span></span><br><span class="line">   p   <span class="built_in">print</span> the partition table   <span class="comment"># 打印分区表</span></span><br><span class="line">   q   quit without saving changes    <span class="comment"># 退出且不保存更改</span></span><br><span class="line">   s   create a new empty Sun disklabel  <span class="comment"># 创建一个新的空的sun卷标</span></span><br><span class="line">   t   change a partition<span class="string">'s system id  # 更改分区系统的id</span></span><br><span class="line"><span class="string">   u   change display/entry units  # 改变/显示条目的单位</span></span><br><span class="line"><span class="string">   v   verify the partition table   # 验证分区表</span></span><br><span class="line"><span class="string">   w   write table to disk and exit  # 将操作写入分区表并退出程序</span></span><br><span class="line"><span class="string">   x   extra functionality (experts only)   # 额外的功能</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (m for help): n   # 输入n，创建一个分区</span></span><br><span class="line"><span class="string">Partition type:</span></span><br><span class="line"><span class="string">   p   primary (0 primary, 0 extended, 4 free)  # 创建主分区，编号1-4</span></span><br><span class="line"><span class="string">   e   extended   # 创建扩展分区</span></span><br><span class="line"><span class="string">Select (default p): p   # 输入p，创建主分区</span></span><br><span class="line"><span class="string">Partition number (1-4, default 1): 1  # 输入1，设置第一个主分区编号为1</span></span><br><span class="line"><span class="string">First sector (2048-41943039, default 2048):   # 直接回车，默认采用2048作为起始柱面</span></span><br><span class="line"><span class="string">Using default value 2048</span></span><br><span class="line"><span class="string">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-41943039, default 41943039): +5G     # 设置结束柱面，一般情况下如果整个磁盘采用一个分区，这里就直接回车就行，否则，采用+size的方式进行分区大小设置，我们这里给第一个分区设置5G的空间    </span></span><br><span class="line"><span class="string">Partition 1 of type Linux and of size 5 GiB is set</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (m for help): p   # 输入p，打印刚创建的分区信息</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors</span></span><br><span class="line"><span class="string">Units = sectors of 1 * 512 = 512 bytes</span></span><br><span class="line"><span class="string">Sector size (logical/physical): 512 bytes / 512 bytes</span></span><br><span class="line"><span class="string">I/O size (minimum/optimal): 512 bytes / 512 bytes</span></span><br><span class="line"><span class="string">Disk label type: dos</span></span><br><span class="line"><span class="string">Disk identifier: 0xc0a89c6e</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Device Boot      Start         End      Blocks   Id  System</span></span><br><span class="line"><span class="string">/dev/sdb1            2048    10487807     5242880   83  Linux</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (m for help):  # 重复上述步骤再次创建三个主分区，大家自己练习，注意全部完成后要按w保存，否则分区信息丢失</span></span><br><span class="line"><span class="string">。。。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 打印最终的分区信息</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@C7-Server01 ~]# fdisk -l /dev/sdb</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors</span></span><br><span class="line"><span class="string">Units = sectors of 1 * 512 = 512 bytes</span></span><br><span class="line"><span class="string">Sector size (logical/physical): 512 bytes / 512 bytes</span></span><br><span class="line"><span class="string">I/O size (minimum/optimal): 512 bytes / 512 bytes</span></span><br><span class="line"><span class="string">Disk label type: dos</span></span><br><span class="line"><span class="string">Disk identifier: 0xc0a89c6e</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Device Boot      Start         End      Blocks   Id  System</span></span><br><span class="line"><span class="string">/dev/sdb1            2048    10487807     5242880   83  Linux</span></span><br><span class="line"><span class="string">/dev/sdb2        10487808    20973567     5242880   83  Linux</span></span><br><span class="line"><span class="string">/dev/sdb3        20973568    31459327     5242880   83  Linux</span></span><br><span class="line"><span class="string">/dev/sdb4        31459328    41943039     5241856   83  Linux</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 不重启情况下通知内核新的分区表已生效</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@C7-Server01 ~]# partprobe /dev/sdb</span></span><br></pre></td></tr></table></figure>
<p><strong>需要注意一点：用交互指令d删除分区时要小心，要注意分区的序号，如果删除了扩展分区，那么扩展分区之下的逻辑分区都会删除，所以操作时一定要小心。如果不小心操作错了，直接使用交互指令q不保存退出，这样先前的操作就会无效。如果输入w（保存指令）则会保存所有修改。</strong></p>
<p><strong>4）非交互式分区</strong></p>
<p>上面的示例是交互式分区，有时需要在脚本中自动执行分区，这时需要非交互式分区。如果使用fdisk分区工具来完成，可以使用如下两种办法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先备份/dev/sdb分区表信息</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># dd if=/dev/sdb of=sdb-partb.info bs=1 count=512</span></span><br><span class="line">512+0 records <span class="keyword">in</span></span><br><span class="line">512+0 records out</span><br><span class="line">512 bytes (512 B) copied, 0.00159899 s, 320 kB/s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后清除分区数据</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># dd if=/dev/zero of=/dev/sdb bs=1 count=512</span></span><br><span class="line">512+0 records <span class="keyword">in</span></span><br><span class="line">512+0 records out</span><br><span class="line">512 bytes (512 B) copied, 0.0017926 s, 286 kB/s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看/dev/sdb分区信息，确认是否被清除</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># fdisk -l /dev/sdb</span></span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法一：使用echo指令模拟交互式分区输入过程，自动执行分区</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 此方法需要注意最后一次分区时不要输入+size大小，直接回车即可（虚拟机虚拟磁盘原因，在物理机上无此限制）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本中p就是指主分区，如果要分扩展分区，将p改为m</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># echo -e "n\np\n1\n\n+5G\nw\n" | fdisk /dev/sdb</span></span><br><span class="line">...</span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># echo -e "n\np\n2\n\n+5G\nw\n" | fdisk /dev/sdb</span></span><br><span class="line">...</span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># echo -e "n\np\n3\n\n+5G\nw\n" | fdisk /dev/sdb</span></span><br><span class="line">...</span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># echo -e "n\np\n4\n\n\nw\n" | fdisk /dev/sdb</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看分区信息</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># fdisk -l /dev/sdb</span></span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0xd0b6c715</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048    10487807     5242880   83  Linux</span><br><span class="line">/dev/sdb2        10487808    20973567     5242880   83  Linux</span><br><span class="line">/dev/sdb3        20973568    31459327     5242880   83  Linux</span><br><span class="line">/dev/sdb4        31459328    41943039     5241856   83  Linux</span><br></pre></td></tr></table></figure>
<p><strong>方法二：也是模拟交互式分区的过程，将输入的交互式指令写入一个文本文件，然后通过标准输入的方式传递给fdisk /dev/sdb指令，其中交互式指令中回车在文本中用换行替代。与上面的实现方式类似，请大家自行练习。</strong></p>
<h2 id="partprobe：更新内核的硬盘分区表信息"><a href="#partprobe：更新内核的硬盘分区表信息" class="headerlink" title="partprobe：更新内核的硬盘分区表信息"></a>partprobe：更新内核的硬盘分区表信息</h2><p>partprobe命令用于在硬盘分区发生改变时，更新Linux内核中的硬盘分区表数据。有时在使用fdisk、part命令对硬盘进行分区后，会发现找不到新分区，此时需要重启系统才能使修改生效，但使用partprobe可以不重启系统就让修改的分区表生效。</p>
<p><strong>语法格式：partprobe [option]</strong> </p>
<p><strong>重要参数选项</strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae336aa7df.jpg"></p>
<p><strong>【使用示例】</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新分区表信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最好加上具体的磁盘，否则可能会报错，那就只能重启系统</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># partprobe /dev/sdb</span></span><br></pre></td></tr></table></figure>
<h2 id="parted：磁盘分区工具"><a href="#parted：磁盘分区工具" class="headerlink" title="parted：磁盘分区工具"></a>parted：磁盘分区工具</h2><p>对于小于2TB的磁盘可以用fdisk和parted命令进行分区，这种情况一般采用fdisk命令，但对于大于2TB的磁盘则只能用parted分区，且需要将磁盘转换为GPT格式。</p>
<p><strong>语法格式：parted [option] [device]</strong></p>
<p><strong>重要参数选项</strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae373158e0.jpg"></p>
<p><strong>【分区命令】</strong></p>
<p><strong>通过parted -h或直接parted进入交互模式后，输入h查看帮助信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@C7-Server01 ~]<span class="comment"># parted -h</span></span><br><span class="line">Usage: parted [OPTION]... [DEVICE [COMMAND [PARAMETERS]...]...]</span><br><span class="line">Apply COMMANDs with PARAMETERS to DEVICE.  If no COMMAND(s) are given, run <span class="keyword">in</span></span><br><span class="line">interactive mode.</span><br><span class="line">OPTIONs:</span><br><span class="line">-h, --<span class="built_in">help</span>                      displays this <span class="built_in">help</span> message</span><br><span class="line">-l, --list                      lists partition layout on all block devices</span><br><span class="line">-m, --machine                   displays machine parseable output</span><br><span class="line">-s, --script                    never prompts <span class="keyword">for</span> user intervention</span><br><span class="line">-v, --version                   displays the version</span><br><span class="line">-a, --align=[none|cyl|min|opt]  alignment <span class="keyword">for</span> new partitions</span><br><span class="line">COMMANDs:</span><br><span class="line">align-check TYPE N                        check partition N <span class="keyword">for</span> TYPE(min|opt)</span><br><span class="line">alignment</span><br><span class="line"><span class="built_in">help</span> [COMMAND]                           <span class="built_in">print</span> general <span class="built_in">help</span>, or <span class="built_in">help</span> on</span><br><span class="line">COMMAND</span><br><span class="line">mklabel,mktable LABEL-TYPE               create a new disklabel (partition</span><br><span class="line">table)</span><br><span class="line">mkpart PART-TYPE [FS-TYPE] START END     make a partition</span><br><span class="line">name NUMBER NAME                         name partition NUMBER as NAME</span><br><span class="line"><span class="built_in">print</span> [devices|free|list,all|NUMBER]     display the partition table,</span><br><span class="line">available devices, free space, all found partitions, or a particular</span><br><span class="line">partition</span><br><span class="line">quit                                     <span class="built_in">exit</span> program</span><br><span class="line">rescue START END                         rescue a lost partition near START</span><br><span class="line">and END</span><br><span class="line">resizepart NUMBER END                    resize partition NUMBER</span><br><span class="line">rm NUMBER                                delete partition NUMBER</span><br><span class="line">select DEVICE                            choose the device to edit</span><br><span class="line">disk_set FLAG STATE                      change the FLAG on selected device</span><br><span class="line">disk_toggle [FLAG]                       toggle the state of FLAG on selected</span><br><span class="line">device</span><br><span class="line"><span class="built_in">set</span> NUMBER FLAG STATE                    change the FLAG on partition NUMBER</span><br><span class="line">toggle [NUMBER [FLAG]]                   toggle the state of FLAG on partition</span><br><span class="line">NUMBER</span><br><span class="line">unit UNIT                                <span class="built_in">set</span> the default unit to UNIT</span><br><span class="line">version                                  display the version number and</span><br><span class="line">copyright information of GNU Parted</span><br><span class="line">Report bugs to bug-parted@gnu.org</span><br></pre></td></tr></table></figure>
<p><strong>【使用示例】</strong></p>
<p><strong>1）显示分区的情况</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@C7-Server01 ~]<span class="comment"># parted -l</span></span><br><span class="line">Model: ATA VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sda: 53.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags: </span><br><span class="line">Number  Start   End     Size    Type     File system     Flags</span><br><span class="line">1      1049kB  420MB   419MB   primary  xfs             boot</span><br><span class="line">2      420MB   9010MB  8590MB  primary  linux-swap(v1)</span><br><span class="line">3      9010MB  53.7GB  44.7GB  primary  xfs</span><br><span class="line">Model: ATA VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags: </span><br><span class="line">Number  Start   End     Size    Type     File system  Flags</span><br><span class="line">1      1049kB  5370MB  5369MB  primary</span><br><span class="line">2      5370MB  10.7GB  5369MB  primary</span><br><span class="line">3      10.7GB  16.1GB  5369MB  primary</span><br><span class="line">4      16.1GB  21.5GB  5368MB  primary</span><br></pre></td></tr></table></figure>
<p>上述信息显示系统两块磁盘的分区信息，包括大小，起始，终止柱面，类型，文件系统类型等。磁盘/dev/sda为系统盘，有3个主分区，其中2个位xfs文件系统，1个位swap分区。磁盘/dev/sdb为刚添加的数据盘，有4个主分区，每个大小5G，因为还没有格式化，所以没有文件系统格式。</p>
<p><strong>2）通过给虚拟机再挂载一块100G的磁盘/dev/sdc，来模拟2TB磁盘用parted分区工具进行分区</strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae3c2d6d94.jpg"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过交互式方式完成分区</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># parted /dev/sdc</span></span><br><span class="line">GNU Parted 3.1</span><br><span class="line">Using /dev/sdc</span><br><span class="line">Welcome to GNU Parted! Type <span class="string">'help'</span> to view a list of commands.</span><br><span class="line">(parted) mklabel gpt           <span class="comment"># 为/dev/sdc磁盘创建GPT分区，大于2T的磁盘必须进行这一步</span></span><br><span class="line">(parted) mkpart primary 0 40G  <span class="comment"># 创建主分区，大小为40G</span></span><br><span class="line">Warning: The resulting partition is not properly aligned <span class="keyword">for</span> best performance.</span><br><span class="line">Ignore/Cancel? Ignore            <span class="comment"># 输入Ignore，忽略告警信息</span></span><br><span class="line">(parted) p                 <span class="comment"># 输入p，显示分区表信息                                               </span></span><br><span class="line">Model: ATA VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdc: 107GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name     Flags</span><br><span class="line"> 1      17.4kB  40.0GB  40.0GB               primary                  <span class="comment"># 第一个主分区已经创建完毕</span></span><br><span class="line">(parted) mkpart logical 40G 50G    <span class="comment"># 创建第一个逻辑分区，大小为10G</span></span><br><span class="line">(parted) p                          <span class="comment">#  打印分区表信息                                      </span></span><br><span class="line">Model: ATA VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdc: 107GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name     Flags</span><br><span class="line"> 1      17.4kB  40.0GB  40.0GB               primary</span><br><span class="line"> 2      40.0GB  50.0GB  10.0GB               logical                        <span class="comment"># 第一个逻辑分区创建完毕</span></span><br><span class="line">(parted) mkpart logical 50G 70G    <span class="comment"># 创建第二个逻辑分区，大小为20G</span></span><br><span class="line">(parted) mkpart logical 70G 100G   <span class="comment"># 创建第三个逻辑分区，大小为30G                                       </span></span><br><span class="line">(parted) p                       <span class="comment"># 打印分区表信息                                         </span></span><br><span class="line">Model: ATA VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdc: 107GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name     Flags</span><br><span class="line"> 1      17.4kB  40.0GB  40.0GB               primary</span><br><span class="line"> 2      40.0GB  50.0GB  10.0GB               logical</span><br><span class="line"> 3      50.0GB  70.0GB  20.0GB               logical</span><br><span class="line"> 4      70.0GB  100GB   30.0GB               logical</span><br><span class="line">(parted) quit                                          <span class="comment"># 退出                   </span></span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统设备信息</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># ll -h /dev/sd*</span></span><br><span class="line">brw-rw---- 1 root disk 8,  0 May  2 11:51 /dev/sda</span><br><span class="line">brw-rw---- 1 root disk 8,  1 May  2 11:51 /dev/sda1</span><br><span class="line">brw-rw---- 1 root disk 8,  2 May  2 11:51 /dev/sda2</span><br><span class="line">brw-rw---- 1 root disk 8,  3 May  2 11:51 /dev/sda3</span><br><span class="line">brw-rw---- 1 root disk 8, 16 May  2 11:51 /dev/sdb</span><br><span class="line">brw-rw---- 1 root disk 8, 17 May  2 11:51 /dev/sdb1</span><br><span class="line">brw-rw---- 1 root disk 8, 18 May  2 11:51 /dev/sdb2</span><br><span class="line">brw-rw---- 1 root disk 8, 19 May  2 11:51 /dev/sdb3</span><br><span class="line">brw-rw---- 1 root disk 8, 20 May  2 11:51 /dev/sdb4</span><br><span class="line">brw-rw---- 1 root disk 8, 32 May  2 12:01 /dev/sdc</span><br><span class="line">brw-rw---- 1 root disk 8, 33 May  2 12:01 /dev/sdc1</span><br><span class="line">brw-rw---- 1 root disk 8, 34 May  2 12:01 /dev/sdc2</span><br><span class="line">brw-rw---- 1 root disk 8, 35 May  2 12:01 /dev/sdc3</span><br><span class="line">brw-rw---- 1 root disk 8, 36 May  2 12:01 /dev/sdc4</span><br></pre></td></tr></table></figure>
<p><strong><em>用parted磁盘分区工具非交互式创建分区的方法类似fdisk，唯一区别就是将交互式下输入的命令作为参数传递parted工具，比如：将交互执行的命令直接放在parted /dev/sdb后面就实现非交互分区了。整体上实现其实比fdisk工具简单，请大家自行练习。</em></strong> </p>
<h2 id="mkfs：创建Linux文件系统-（格式化）"><a href="#mkfs：创建Linux文件系统-（格式化）" class="headerlink" title="mkfs：创建Linux文件系统 （格式化）"></a>mkfs：创建Linux文件系统 （格式化）</h2><p>mkfs命令用于在指定的设备（或硬盘分区等）上格式化并创建文件系统，fdisk和parted等分区工具相当于建房的人，把房子（硬盘），分成几居室（分区），mkfs就相当于对不同的居室装修（创建文件系统）了，只有装修好的房子（有文件系统）才能入住，分区也是一样，只有格式化创建文件系统（存取数据的机制）后，才能用来存取数据。</p>
<p><strong>mkfs只是一个前端命令，它通过-t参数指定文件系统类型后会调用相应的命令mkfs.fstype。因此，也可以直接使用mkfs.ext4、mkfs.xfs这类命令创建相应的文件系统。</strong></p>
<p><strong>语法格式：mkfs [option] [filesys]</strong></p>
<p><strong>重要参数选项</strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae3fee7aba.jpg"></p>
<p><strong>【使用示例】</strong></p>
<p><strong>通过-t选项创建xfs文件系统和ext4文件系统</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建/dev/sdb1分区的文件系统为xfs</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># mkfs -t xfs /dev/sdb1</span></span><br><span class="line">meta-data=/dev/sdb1              isize=512    agcount=4, agsize=327680 blks</span><br><span class="line">=                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">=                       crc=1        finobt=0, sparse=0</span><br><span class="line">data     =                       bsize=4096   blocks=1310720, imaxpct=25</span><br><span class="line">=                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=2560, version=2</span><br><span class="line">=                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>
<p><strong><em>确认是否创建成功</em></strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae42a1b479.jpg"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用mkfs.xfs创建/dev/sdb2的文件系统为xfs</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># mkfs.xfs /dev/sdb2</span></span><br><span class="line">meta-data=/dev/sdb2              isize=512    agcount=4, agsize=327680 blks</span><br><span class="line">=                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">=                       crc=1        finobt=0, sparse=0</span><br><span class="line">data     =                       bsize=4096   blocks=1310720, imaxpct=25</span><br><span class="line">=                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=2560, version=2</span><br><span class="line">=                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>
<p><strong><em>再次确认</em></strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae4502e412.jpg"></p>
<p><strong>创建ext4文件系统的方法类似，请大家自行练习。</strong> </p>
<h2 id="dumpe2fs：导出ext2-ext3-ext4文件系统信息"><a href="#dumpe2fs：导出ext2-ext3-ext4文件系统信息" class="headerlink" title="dumpe2fs：导出ext2/ext3/ext4文件系统信息"></a>dumpe2fs：导出ext2/ext3/ext4文件系统信息</h2><p>dumpe2fs命令用于导出ext2/ext3/ext4文件系统内部的相关信息，例如：文件系统的组成包含超级快、块组、inode、block等信息。<strong>如果要导出xfs文件系统的信息，需要使用xfs_info指令</strong>。</p>
<p><strong>语法格式：dumpe2fs [option] [device]</strong></p>
<p><strong>重要参数选项</strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae470c6349.jpg"></p>
<p><strong>【使用示例】</strong></p>
<p><strong>1）查看分区文件系统的inode信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建/dev/sdb3分区为ext4文件系统格式</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># mkfs.ext4 /dev/sdb3</span></span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Fragment size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">327680 inodes, 1310720 blocks</span><br><span class="line">65536 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=1342177280</span><br><span class="line">40 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">	32768, 98304, 163840, 229376, 294912, 819200, 884736</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span>                            </span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (32768 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出/dev/sdb3分区的中inode相关信息</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># dumpe2fs /dev/sdb3 | egrep -i "inode size|inode count"</span></span><br><span class="line">dumpe2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Inode count:              327680</span><br><span class="line">Inode size:	          256</span><br></pre></td></tr></table></figure>
<p><strong>2）在xfs文件系统下，使用xfs_info指令查看/dev/sdb1的inode信息和block信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先需要个/dev/sdb1分区设置一个挂载点，然后使用xfs_info + 挂载点的方式进行查看</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># mount /dev/sdb1 ~/mydata/</span></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># xfs_info ~/mydata/</span></span><br><span class="line">meta-data=/dev/sdb1              isize=512    agcount=4, agsize=327680 blks</span><br><span class="line">=                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">=                       crc=1        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=1310720, imaxpct=25</span><br><span class="line">=                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal               bsize=4096   blocks=2560, version=2</span><br><span class="line">=                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>
<h2 id="fsck：检查并修复Linux文件系统"><a href="#fsck：检查并修复Linux文件系统" class="headerlink" title="fsck：检查并修复Linux文件系统"></a>fsck：检查并修复Linux文件系统</h2><p>fsck命令用于检查并修复文件系统中的错误，即针对有问题的系统或磁盘进行修复，类似的命令还有e2fsck命令。有关fsck的使用需要特别注意的是：1）文件系统必须是卸载状态，否则可能会出现故障。2）不要对正常的分区使用fsck，在不加参数的情况下，fsck会根据/etc/fstab进行文件系统检查，这相当于fsck-As参数的功能。</p>
<p><strong>注意：必须卸载文件系统后才能对其进行检查，否则可能会出现错误。平时没有必要使用这个命令检查磁盘，只有当系统开机显示磁盘错误时，才需要执行。</strong></p>
<p><strong>语法格式：fsck [option] [filesys]</strong></p>
<p><strong>重要选项参数</strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae4da09a97.jpg"></p>
<p><strong>【使用示例】</strong></p>
<p><strong>1）系统开机通过fsck自检</strong></p>
<p>Linux在开机过程中系统会自动调用fsck命令对需要自检的磁盘进行自检，如下图：</p>
<p><img src="https://i.loli.net/2019/05/02/5ccae4f632933.jpg"></p>
<p>这是因为系统开机过程中会优先读取/etc/fstab文件，当最后一列设置为1或2时，这个磁盘在开机时就会调用fsck进行自检，fstab的文件（man fstab看帮助）信息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@C7-Server01 ~]<span class="comment"># cat /etc/fstab </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Created by anaconda on Sun Apr  7 20:32:53 2019</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=0887567f-1df6-425f-ba3d-ce58584279e0 /                       xfs     defaults        0 0</span><br><span class="line">UUID=26954b3f-dd29-4a25-85ba-471cdbbf82df /boot                   xfs     defaults        0 0</span><br><span class="line">UUID=1f9ad06d-860c-4166-b142-6b633ee82851 swap                    swap    defaults        0 0</span><br></pre></td></tr></table></figure>
<p><strong>在CentOS6系统中，系统分区的根分区最后一列一般是1，boot分区最后一列是2，其余是0。但是在CentOS7系统中，为了不影响系统启动，把系统分区最后1列均设为0，即开机不自检。</strong></p>
<p><strong>需要提醒一下：有时我们自己增加硬盘规划分区，一般最后一列都设置为0，即开机过程中不对磁盘检查，否则，一旦自定义挂载的磁盘有问题，会影响系统启动。 如果真有问题，可以在启动系统后人为进行检查。</strong></p>
<p><strong>2）Linux断电后重启故障修复</strong></p>
<p>当Linux系统遭遇突然断电等非正常关机操作时，很容易导致文件系统数据损坏，造成系统不能重新启动，此时，屏幕出现的提示可能是如下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* AN error occurred during the file system check</span><br><span class="line">*** xxx</span><br><span class="line">*** xxx</span><br><span class="line">Give root password <span class="keyword">for</span> maintenance</span><br><span class="line">(or <span class="built_in">type</span> Control-D to <span class="built_in">continue</span>):</span><br></pre></td></tr></table></figure>
<p>此时根据系统提示输入root用户的密码，注意而不是直接按Control-D继续，会再重启。</p>
<p>当输入正确的密码之后，正常会出现下面的提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Repair filesystem) 1 <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>此时就可以输入fsck或者fsck-A对磁盘进行修复检查，执行后可能出现一堆询问，按yes即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(Repair filesystem) 1 <span class="comment"># fsck -A #&lt;==可能会等待一段时间或fsck。</span></span><br><span class="line">(Repair filesystem) 2 <span class="comment"># #&lt;==修复完毕会返回到这个提示符，此时就可以试着重启系统看故障是否修复了。</span></span><br></pre></td></tr></table></figure>
<p><strong>除了按照开机的提示进行修复外，也可以利用系统盘进入救援模式或单用户模式对系统故障进行修复。千万不要在开机正常工作的情况下执行fsck来检查磁盘，因为这样有可能会导致正常的磁盘发生故障。</strong></p>
<h2 id="mount：挂载文件系统"><a href="#mount：挂载文件系统" class="headerlink" title="mount：挂载文件系统"></a>mount：挂载文件系统</h2><p>mount命令可以将指定的文件系统挂载到指定目录（挂载点），在Linux系统下必须先挂载所有的设备，然后才能被访问，挂载其实就是为要访问的设置开个门（开门才能访问）。挂载的目录必须事先存在且最好为空，如果目录不为空，那么挂载设备后会掩盖以前的目录内容，但原目录下的内容不会受损，所以，如果卸载了相应的设备，那么此前的目录内容又可以访问了。</p>
<p><strong>语法格式：mount [option] [device] [dir]</strong></p>
<p><strong>重要选项参数</strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae591533e9.jpg"></p>
<p>其中，-o选项后接的挂载参数如下：</p>
<p><img src="https://i.loli.net/2019/05/02/5ccae5a7e7b0e.jpg"></p>
<p><strong>【使用示例】</strong></p>
<p><strong>1）显示系统已挂载的信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不加参数或加-l选项</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># mount</span></span><br><span class="line">sysfs on /sys <span class="built_in">type</span> sysfs (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">proc on /proc <span class="built_in">type</span> proc (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">devtmpfs on /dev <span class="built_in">type</span> devtmpfs (rw,nosuid,size=3984384k,nr_inodes=996096,mode=755)</span><br><span class="line">securityfs on /sys/kernel/security <span class="built_in">type</span> securityfs (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">tmpfs on /dev/shm <span class="built_in">type</span> tmpfs (rw,nosuid,nodev)</span><br><span class="line">devpts on /dev/pts <span class="built_in">type</span> devpts (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000)</span><br><span class="line">tmpfs on /run <span class="built_in">type</span> tmpfs (rw,nosuid,nodev,mode=755)</span><br><span class="line">tmpfs on /sys/fs/cgroup <span class="built_in">type</span> tmpfs (ro,nosuid,nodev,noexec,mode=755)</span><br><span class="line">cgroup on /sys/fs/cgroup/systemd <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)</span><br><span class="line">pstore on /sys/fs/pstore <span class="built_in">type</span> pstore (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">cgroup on /sys/fs/cgroup/perf_event <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)</span><br><span class="line">cgroup on /sys/fs/cgroup/memory <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,memory)</span><br><span class="line">cgroup on /sys/fs/cgroup/blkio <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,blkio)</span><br><span class="line">cgroup on /sys/fs/cgroup/net_cls,net_prio <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls)</span><br><span class="line">cgroup on /sys/fs/cgroup/devices <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,devices)</span><br><span class="line">cgroup on /sys/fs/cgroup/pids <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,pids)</span><br><span class="line">cgroup on /sys/fs/cgroup/hugetlb <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpu,cpuacct <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpuset <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)</span><br><span class="line">cgroup on /sys/fs/cgroup/freezer <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,freezer)</span><br><span class="line">configfs on /sys/kernel/config <span class="built_in">type</span> configfs (rw,relatime)</span><br><span class="line">/dev/sda3 on / <span class="built_in">type</span> xfs (rw,relatime,attr2,inode64,noquota)</span><br><span class="line">debugfs on /sys/kernel/debug <span class="built_in">type</span> debugfs (rw,relatime)</span><br><span class="line">hugetlbfs on /dev/hugepages <span class="built_in">type</span> hugetlbfs (rw,relatime)</span><br><span class="line">systemd-1 on /proc/sys/fs/binfmt_misc <span class="built_in">type</span> autofs (rw,relatime,fd=32,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=24337)</span><br><span class="line">mqueue on /dev/mqueue <span class="built_in">type</span> mqueue (rw,relatime)</span><br><span class="line">/dev/sda1 on /boot <span class="built_in">type</span> xfs (rw,relatime,attr2,inode64,noquota)</span><br><span class="line">tmpfs on /run/user/0 <span class="built_in">type</span> tmpfs (rw,nosuid,nodev,relatime,size=799032k,mode=700)</span><br><span class="line">/dev/sdb1 on /root/mydata <span class="built_in">type</span> xfs (rw,relatime,attr2,inode64,noquota)</span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># mount -l</span></span><br><span class="line">sysfs on /sys <span class="built_in">type</span> sysfs (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">proc on /proc <span class="built_in">type</span> proc (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">devtmpfs on /dev <span class="built_in">type</span> devtmpfs (rw,nosuid,size=3984384k,nr_inodes=996096,mode=755)</span><br><span class="line">securityfs on /sys/kernel/security <span class="built_in">type</span> securityfs (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">tmpfs on /dev/shm <span class="built_in">type</span> tmpfs (rw,nosuid,nodev)</span><br><span class="line">devpts on /dev/pts <span class="built_in">type</span> devpts (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000)</span><br><span class="line">tmpfs on /run <span class="built_in">type</span> tmpfs (rw,nosuid,nodev,mode=755)</span><br><span class="line">tmpfs on /sys/fs/cgroup <span class="built_in">type</span> tmpfs (ro,nosuid,nodev,noexec,mode=755)</span><br><span class="line">cgroup on /sys/fs/cgroup/systemd <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)</span><br><span class="line">pstore on /sys/fs/pstore <span class="built_in">type</span> pstore (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">cgroup on /sys/fs/cgroup/perf_event <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)</span><br><span class="line">cgroup on /sys/fs/cgroup/memory <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,memory)</span><br><span class="line">cgroup on /sys/fs/cgroup/blkio <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,blkio)</span><br><span class="line">cgroup on /sys/fs/cgroup/net_cls,net_prio <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls)</span><br><span class="line">cgroup on /sys/fs/cgroup/devices <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,devices)</span><br><span class="line">cgroup on /sys/fs/cgroup/pids <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,pids)</span><br><span class="line">cgroup on /sys/fs/cgroup/hugetlb <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpu,cpuacct <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpuset <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)</span><br><span class="line">cgroup on /sys/fs/cgroup/freezer <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,freezer)</span><br><span class="line">configfs on /sys/kernel/config <span class="built_in">type</span> configfs (rw,relatime)</span><br><span class="line">/dev/sda3 on / <span class="built_in">type</span> xfs (rw,relatime,attr2,inode64,noquota)</span><br><span class="line">debugfs on /sys/kernel/debug <span class="built_in">type</span> debugfs (rw,relatime)</span><br><span class="line">hugetlbfs on /dev/hugepages <span class="built_in">type</span> hugetlbfs (rw,relatime)</span><br><span class="line">systemd-1 on /proc/sys/fs/binfmt_misc <span class="built_in">type</span> autofs (rw,relatime,fd=32,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=24337)</span><br><span class="line">mqueue on /dev/mqueue <span class="built_in">type</span> mqueue (rw,relatime)</span><br><span class="line">/dev/sda1 on /boot <span class="built_in">type</span> xfs (rw,relatime,attr2,inode64,noquota)</span><br><span class="line">tmpfs on /run/user/0 <span class="built_in">type</span> tmpfs (rw,nosuid,nodev,relatime,size=799032k,mode=700)</span><br><span class="line">/dev/sdb1 on /root/mydata <span class="built_in">type</span> xfs (rw,relatime,attr2,inode64,noquota)</span><br></pre></td></tr></table></figure>
<p><strong>2）对系统的光驱进行挂载</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不使用-t选项指定类型为 iso9660，但mount命令可以自动识别</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># mount /dev/cdrom /mnt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示为只读挂载</span></span><br><span class="line"></span><br><span class="line">mount: /dev/sr0 is write-protected, mounting <span class="built_in">read</span>-only</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看/dev/cdrom文件，发现设备cdrom是sr0的一个软链接</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># ll -h /dev/cdrom</span></span><br><span class="line">lrwxrwxrwx 1 root root 3 May  2 18:10 /dev/cdrom -&gt; sr0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否挂载</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        42G  2.6G   40G   7% /</span><br><span class="line">devtmpfs        3.8G     0  3.8G   0% /dev</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /dev/shm</span><br><span class="line">tmpfs           3.9G   12M  3.8G   1% /run</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1       397M  162M  236M  41% /boot</span><br><span class="line">tmpfs           781M     0  781M   0% /run/user/0</span><br><span class="line">/dev/sdb1       5.0G   33M  5.0G   1% /root/mydata</span><br><span class="line">/dev/sr0        4.3G  4.3G     0 100% /mnt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看挂载点内容</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># ll -h /mnt</span></span><br><span class="line">total 686K</span><br><span class="line">-rw-rw-r-- 1 root root   14 Nov 26 00:01 CentOS_BuildTag</span><br><span class="line">drwxr-xr-x 3 root root 2.0K Nov 26 00:20 EFI</span><br><span class="line">-rw-rw-r-- 1 root root  227 Aug 30  2017 EULA</span><br><span class="line">-rw-rw-r-- 1 root root  18K Dec 10  2015 GPL</span><br><span class="line">drwxr-xr-x 3 root root 2.0K Nov 26 00:21 images</span><br><span class="line">drwxr-xr-x 2 root root 2.0K Nov 26 00:20 isolinux</span><br><span class="line">drwxr-xr-x 2 root root 2.0K Nov 26 00:20 LiveOS</span><br><span class="line">drwxrwxr-x 2 root root 648K Nov 26 07:52 Packages</span><br><span class="line">drwxrwxr-x 2 root root 4.0K Nov 26 07:53 repodata</span><br><span class="line">-rw-rw-r-- 1 root root 1.7K Dec 10  2015 RPM-GPG-KEY-CentOS-7</span><br><span class="line">-rw-rw-r-- 1 root root 1.7K Dec 10  2015 RPM-GPG-KEY-CentOS-Testing-7</span><br><span class="line">-r--r--r-- 1 root root 2.9K Nov 26 07:54 TRANS.TBL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载挂载点</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># umount /mnt/</span></span><br></pre></td></tr></table></figure>
<p>在实际中，我们经常会挂载NFS（网络文件系统），这就要用到mount命令的-o选项，来保证性能和安全性。具体的说明，请参见本站Linux常用工具分类中的NFS文件系统一文。</p>
<h2 id="umount：卸载文件系统"><a href="#umount：卸载文件系统" class="headerlink" title="umount：卸载文件系统"></a>umount：卸载文件系统</h2><p>umount命令可以卸载已经挂载的文件系统，如上文中示例2的卸载挂载点。<strong>umount卸载可以接挂载点目录，也可以接设备文件。</strong></p>
<p><strong>语法格式：umount [option] [dir|device]</strong></p>
<p><strong>重要选项参数</strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae65d205b3.jpg"></p>
<p><strong>【使用示例】</strong></p>
<p><strong>1）卸载光驱挂载</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先挂载光驱</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># mount -t iso9660 /dev/cdrom /mnt</span></span><br><span class="line">mount: /dev/sr0 is write-protected, mounting <span class="built_in">read</span>-only</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统挂载信息</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        42G  2.6G   40G   7% /</span><br><span class="line">devtmpfs        3.8G     0  3.8G   0% /dev</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /dev/shm</span><br><span class="line">tmpfs           3.9G   12M  3.8G   1% /run</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1       397M  162M  236M  41% /boot</span><br><span class="line">tmpfs           781M     0  781M   0% /run/user/0</span><br><span class="line">/dev/sdb1       5.0G   33M  5.0G   1% /root/mydata</span><br><span class="line">/dev/sr0        4.3G  4.3G     0 100% /mnt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用设备文件卸载</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># umount /dev/cdrom</span></span><br></pre></td></tr></table></figure>
<p><strong>2）强制卸载</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 挂载光驱，并进入挂载点</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># mount /dev/cdrom /mnt &amp;&amp; cd /mnt</span></span><br><span class="line">mount: /dev/sr0 is write-protected, mounting <span class="built_in">read</span>-only</span><br><span class="line">[root@C7-Server01 mnt]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时尝试卸载光驱，会提示设备忙，无法卸载</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 mnt]<span class="comment"># umount /mnt</span></span><br><span class="line">umount: /mnt: target is busy.</span><br><span class="line">        (In some cases useful info about processes that use</span><br><span class="line">         the device is found by lsof(8) or fuser(1))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用-lf选项强制卸载</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 mnt]<span class="comment"># umount -lf /mnt</span></span><br><span class="line">[root@C7-Server01 mnt]<span class="comment"># df -h</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        42G  2.6G   40G   7% /</span><br><span class="line">devtmpfs        3.8G     0  3.8G   0% /dev</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /dev/shm</span><br><span class="line">tmpfs           3.9G   12M  3.8G   1% /run</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1       397M  162M  236M  41% /boot</span><br><span class="line">tmpfs           781M     0  781M   0% /run/user/0</span><br><span class="line">/dev/sdb1       5.0G   33M  5.0G   1% /root/mydata</span><br></pre></td></tr></table></figure>
<h2 id="sync：刷新文件系统缓冲区"><a href="#sync：刷新文件系统缓冲区" class="headerlink" title="sync：刷新文件系统缓冲区"></a>sync：刷新文件系统缓冲区</h2><p>sync命令会将内存缓冲区内的数据强制刷新到磁盘。Linux内核为了达到最佳的磁盘操作效率，默认会先在内存中将需要写入到磁盘的数据缓存起来，然后等待合适的时机将它们真正写入到磁盘中，这在绝大多数情况下都是没有任何问题的，而且还提高了系统的效率，但是如果系统出现宕机、掉电等情况，就可能会导致有些文件内容没能保存下来。当然，在Linux系统正常关机或者重启时，会将缓冲区中的内容自动同步到磁盘中。我们也可以手工执行sync命令，将内存中的文件缓冲内容强制写到磁盘中。</p>
<p>但是通常情况下没有必要执行这个命令，一是Linux内核会尽快让内存中的数据自动同步到磁盘上去，二是我们也无法预计什么时候会宕机、掉电。</p>
<p><strong>语法格式：sync [option]</strong> </p>
<p><strong>【使用示例】</strong></p>
<p><strong>手动将数据从缓冲区刷到磁盘中并重启系统</strong></p>
<p>**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写一个测试循环脚本来完成三次同步，每次间隔1秒，然后重启系统**</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 mnt]<span class="comment"># for i in `seq 3`;do sync;sleep 1; done &amp;&amp; reboot;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2019/05/02/5ccae6c094551.jpg"></p>
<h2 id="dd：转换或复制文件"><a href="#dd：转换或复制文件" class="headerlink" title="dd：转换或复制文件"></a>dd：转换或复制文件</h2><p>dd命令具有复制文件、转换文件和格式化文本的功能。</p>
<p><strong>语法格式：dd [option]</strong> </p>
<p><strong>重要选项参数</strong></p>
<p><img src="https://i.loli.net/2019/05/02/5ccae8ce512d2.jpg"></p>
<p><strong>【使用示例】</strong></p>
<p><strong>1）将/dev/sda1分区复制（备份）到文件中</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看磁盘使用情况</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        42G  2.6G   40G   7% /</span><br><span class="line">devtmpfs        3.8G     0  3.8G   0% /dev</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /dev/shm</span><br><span class="line">tmpfs           3.9G   12M  3.8G   1% /run</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1       397M  162M  236M  41% /boot</span><br><span class="line">tmpfs           781M     0  781M   0% /run/user/0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份分区表信息</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># dd if=/dev/sda1 of=sda1-partb.info</span></span><br><span class="line">819200+0 records <span class="keyword">in</span></span><br><span class="line">819200+0 records out</span><br><span class="line">419430400 bytes (419 MB) copied, 5.68928 s, 73.7 MB/s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看输出文件的信息</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># ll -h sda1-partb.info </span></span><br><span class="line">-rw-r--r-- 1 root root 400M May  2 19:48 sda1-partb.info</span><br></pre></td></tr></table></figure>
<p><strong>2）删除/dev/sdb1分区数据</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 挂载/dev/sdb1分区到root用户家目录下的mydata/目录</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># mount /dev/sdb1 mydata/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在mydata/目录下创建1000个文件</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># touch mydata/file&#123;01..1000&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统挂载信息，发现/dev/sdb1已使用33M，占比1%</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        42G  3.0G   39G   8% /</span><br><span class="line">devtmpfs        3.8G     0  3.8G   0% /dev</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /dev/shm</span><br><span class="line">tmpfs           3.9G   12M  3.8G   1% /run</span><br><span class="line">tmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1       397M  162M  236M  41% /boot</span><br><span class="line">tmpfs           781M     0  781M   0% /run/user/0</span><br><span class="line">/dev/sdb1       5.0G   33M  5.0G   1% /root/mydata</span><br><span class="line"></span><br><span class="line"><span class="comment"># /dev/zero设备读取数据，写入到/dev/sdb1中，就会清空/dev/sdb1分区的数据</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># dd if=/dev/zero of=/dev/sdb1</span></span><br><span class="line">dd: writing to ‘/dev/sdb1’: No space left on device  <span class="comment"># 提示磁盘被写满</span></span><br><span class="line">10485761+0 records <span class="keyword">in</span></span><br><span class="line">10485760+0 records out</span><br><span class="line">5368709120 bytes (5.4 GB) copied, 73.561 s, 73.0 MB/s</span><br></pre></td></tr></table></figure>
<p><strong><em>/dev/zero是0字符设备，可产生连续不断的特殊数据流，生成的文件为特殊格式的数据文件（二进制）。</em></strong></p>
<p><strong>3）生成任意大小的文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个大小为10M的测试文件test01</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># dd if=/dev/zero of=test01 bs=1M count=10</span></span><br><span class="line">10+0 records <span class="keyword">in</span></span><br><span class="line">10+0 records out</span><br><span class="line">10485760 bytes (10 MB) copied, 0.136475 s, 76.8 MB/s</span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># ll -h test01 </span></span><br><span class="line">-rw-r--r-- 1 root root 10M May  2 20:11 test01</span><br></pre></td></tr></table></figure>
<p><strong>生成文件test01的大小为bs*count=1M*10=10M。</strong></p>
<p><strong>4）生成CentOS7的镜像文件</strong></p>
<p>在Windows系统里制作光盘的ISO镜像，还需要安装其他软件。但在Linux系统中只需要dd命令就足够了，可以使用dd命令，将从光驱读取的镜像复制到系统中，相当于光驱与磁盘对拷。使用此类防范可以不用ftp工具或lrzsz工具对镜像文件进行上传。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@C7-Server01 ~]<span class="comment"># dd if=/dev/cdrom of=CentOS74.img</span></span><br><span class="line">8962048+0 records <span class="keyword">in</span></span><br><span class="line">8962048+0 records out</span><br><span class="line">4588568576 bytes (4.6 GB) copied, 30.8377 s, 149 MB/s</span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># ll -h CentOS74.img </span></span><br><span class="line">-rw-r--r-- 1 root root 4.3G May  2 20:16 CentOS74.img</span><br></pre></td></tr></table></figure>
<p>这样我们就创建了一个用于KVM或OpenStack的母版镜像文件CentOS74.img。</p>
<p><strong>5）使用dd复制文件，并转换大小写</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在当前目录下创建测试文件，内容随便编辑</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># cat &gt; file01 &lt;&lt; EOF</span></span><br><span class="line">WWW.sn.Chinamobile.com</span><br><span class="line">我爱北京天安门！！！1234</span><br><span class="line">www.sina.com.CN</span><br><span class="line"><span class="comment">###!www.openstack.org</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用dd复制文件，并将原文件中所有大写字母转换为小写字母</span></span><br><span class="line"></span><br><span class="line">&gt; EOF</span><br><span class="line">&gt; [root@C7-Server01 ~]<span class="comment"># dd if=file01 of=file01_new conv=lcase</span></span><br><span class="line">&gt; 0+1 records <span class="keyword">in</span></span><br><span class="line">&gt; 0+1 records out</span><br><span class="line">&gt; 96 bytes (96 B) copied, 0.000108961 s, 881 kB/s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产看file01_new文件内容</span></span><br><span class="line"></span><br><span class="line">[root@C7-Server01 ~]<span class="comment"># cat file01_new</span></span><br><span class="line">www.sn.chinamobile.com</span><br><span class="line">我爱北京天安门！！！1234</span><br><span class="line">www.sina.com.cn</span><br><span class="line"><span class="comment">###!www.openstack.org</span></span><br></pre></td></tr></table></figure>
<p><strong><em>Linux磁盘与文件系统管理命令掌握上述命令即可，还有三个用于交换分区管理的命令mkswap（创建交换分区）、swapon（激活交换分区）和swapoff（关闭交换分区）很少会被使用到，大家知道即可。如果在实际运维中需要，到时再通过man查询帮助即可。</em></strong></p>

      
    </div>

    

    
    
    

    

    
      
    
	
	<div>
	
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
	
	</div>
	
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById(&quot;QR&quot;); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="kkutysllb 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.png" alt="kkutysllb 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        



  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>kkutysllb</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="https://kkutysllb.cn/2019/05/02/2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》/" title="2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》">https://kkutysllb.cn/2019/05/02/2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/05/02/2019-05-01-Linux系统命令-第六篇《用户和权限管理命令》/" rel="next" title="2019-05-01-Linux系统命令-第六篇《用户和权限管理命令》">
                <i class="fa fa-chevron-left"></i> 2019-05-01-Linux系统命令-第六篇《用户和权限管理命令》
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/03/2019-05-03-虚拟化技术基础/" rel="prev" title="2019-05-03-虚拟化技术基础">
                2019-05-03-虚拟化技术基础 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80MjY0Ni8xOTE5Mw=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="kkutysllb">
            
              <p class="site-author-name" itemprop="name">kkutysllb</p>
              <p class="site-description motion-element" itemprop="description">容易走的路是下坡路<br>总是不经意间装个X得罪一票人</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">28</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/kkutysllb" title="GitHub &rarr; https://github.com/kkutysllb" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:linbrid772233@gmail.com" title="E-Mail &rarr; mailto:linbrid772233@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-e-mail"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/u/2243838583?is_all=1" title="Weibo &rarr; https://weibo.com/u/2243838583?is_all=1" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.zhihu.com/people/tang-xi-yao-43/activities" title="Zhihu &rarr; https://www.zhihu.com/people/tang-xi-yao-43/activities" rel="noopener" target="_blank"><i class="fa fa-fw fa-zhihu"></i>Zhihu</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#fdisk：磁盘分区工具"><span class="nav-number">1.</span> <span class="nav-text">fdisk：磁盘分区工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#partprobe：更新内核的硬盘分区表信息"><span class="nav-number">2.</span> <span class="nav-text">partprobe：更新内核的硬盘分区表信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#parted：磁盘分区工具"><span class="nav-number">3.</span> <span class="nav-text">parted：磁盘分区工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mkfs：创建Linux文件系统-（格式化）"><span class="nav-number">4.</span> <span class="nav-text">mkfs：创建Linux文件系统 （格式化）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dumpe2fs：导出ext2-ext3-ext4文件系统信息"><span class="nav-number">5.</span> <span class="nav-text">dumpe2fs：导出ext2/ext3/ext4文件系统信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fsck：检查并修复Linux文件系统"><span class="nav-number">6.</span> <span class="nav-text">fsck：检查并修复Linux文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mount：挂载文件系统"><span class="nav-number">7.</span> <span class="nav-text">mount：挂载文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#umount：卸载文件系统"><span class="nav-number">8.</span> <span class="nav-text">umount：卸载文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sync：刷新文件系统缓冲区"><span class="nav-number">9.</span> <span class="nav-text">sync：刷新文件系统缓冲区</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dd：转换或复制文件"><span class="nav-number">10.</span> <span class="nav-text">dd：转换或复制文件</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kkutysllb</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">310k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">4:41</span>
  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  


  
    <script>
  window.livereOptions = {
    refer: '2019/05/02/2019-05-02-Linux系统命令-第七篇《磁盘和文件系统管理命令》/'
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>

  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function(i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
        var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('复制成功');
          else $(this).text('复制失败');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function(e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function() {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


</body>
</html>
